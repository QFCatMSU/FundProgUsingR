<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
  <meta charset="UTF-8">
  <noscript>
  <link rel="stylesheet" type="text/css" href="/content/DEVELOPMENT/2018/courses/DEV-belinsky-2018-BackendTest/Programming/editor.css">
  </noscript>
  <script src="https://cdn.jsdelivr.net/gh/QFCatMSU/OnlineClassBackEnd/module.js">
  </script>
</head>
<body>

<p class="previousLesson">Which Statements</p>
<p class="nextLesson">Datetime Objects</p>
<h1 class="title" id="title">2-05 Which and Regular Expressions</h1>
<h3>To-do</h3>
<h2>Purpose</h2>
<ul>
<li>use which() on string values</li>
<li>Regular Expressions to find a basic patterns within a string</li>
<li>union() and intersect() to combine conditions</li>
</ul>
<h2>Script and data for this lesson</h2>
<p>The script for this lesson <a href="https://github.com/QFCatMSU/FundProgUsingR/raw/master/scripts/2-05_WhichAndRegularExpressions.R" target="_blank" rel="noopener" title="">can be downloaded here.</a> (right-click, <em><strong>save file as...</strong></em>, save to <em><strong>scripts </strong></em>folder)</p>
<p>The data for this lesson <a href="../data/Lansing2016Noaa-3.csv" target="_blank" rel="noopener">can be downloaded here</a> (left click, save to <em><strong>data </strong></em>folder)</p>
<h2>Which on string data</h2>
<p>Like last lesson we are going to use the the data from <em><strong>Lansing2016NOAA-3.csv</strong></em>:</p>
<blockquote>
<p>weatherData = read.csv(file="data/Lansing2016NOAA-3.csv");</p>
</blockquote>
<p></p>
<p>In the last lesson we used <em><strong>which() </strong></em>to find numeric values in a vector that met a specific condition:</p>
<blockquote>
<p>highPrecip = which(precipNum &gt; 1);</p>
</blockquote>
<p></p>
<p>And there were 8 days with precipitation greater than 1 inch:</p>
<blockquote>
<p title="Console" class="nn">&gt; highPrecip<br>[1] &nbsp;73 &nbsp;91 225 228 229 273 290 307</p>
</blockquote>
<h3>Identifying values using which()</h3>
<p>In this lesson we will be searching for values that meet a condition within string (<em><strong>chr</strong></em>) columns.&nbsp;</p>
<p></p>
<p>In <em><strong>weatherData</strong></em>, the string column <em><strong>weatherType </strong></em>contains information about the type of weather (e.g., Fog, Snow, Rain, etc.) that occurred during that day:</p>
<p><img src="../images/R-2-05_weatherType.jpg" alt="" data-d2l-editor-default-img-style="true" style="max-width: 100%;" class="fs"></p>
<p class="fig" id="weatherTypeCol">The <strong>weatherType </strong>column within the <strong class="weathertype">weatherData </strong>data frame</p>
<p></p>
<p>We can use <em><strong>which</strong><strong>(</strong><strong>)</strong></em> to find which values in <em><strong>weatherType </strong></em>are equal to a specific string, for instance, which values are equal to snow, "SN"?</p>
<p class="code partial">snowyDays = which(weatherData$weatherType == "SN");</p>
<p></p>
<p>The above code:</p>
<ol>
<li>Cycles through each value in the <em><strong>weatherType </strong></em>column&nbsp;</li>
<li>Check if the value is equal to "SN"</li>
<li>Create a vector that has the index of all the values in the vector equal to "SN"</li>
<li>Save that vector to <em><strong>snowyDays</strong></em></li>
</ol>
<p></p>
<p>The result is a vector, <em><strong>snowyDays</strong></em>, with <strong>11 </strong>values, so <strong>11 </strong>days exclusively had snow:</p>
<blockquote>
<p title="Environment" class="nn">snowyDays: int [1:11] 3 16 17 29 ...</p>
</blockquote>
<p></p>
<p>There were many more days with snow but many were not counted in the search because those days had other weather condition.&nbsp; For instance, the first and fourth column in <em id="r-weatherTypeCol" class="ref">fig ##</em> had snow (SN) and breeze (BR). We will deal with those situations later in this lesson when we talk about <em><strong>grep()</strong></em> and Regular Expressions.</p>
<h2>Using the indexed value generated by which()</h2>
<p>We can use the vector of indexed values (<em><strong>snowyDays</strong></em>) <em></em>to index other vectors like <em><strong>avgTemp</strong> </em>and <em><strong>avgWind</strong></em>.&nbsp;</p>
<p></p>
<p>Let's find the temperatures and wind speeds on days that it was snowy</p>
<p class="code partial">&nbsp; snowyDayTemps = weatherData$avgTemp[snowyDays];<br>&nbsp; snowyDayWinds = weatherData$windSpeed[snowyDays];</p>
<p>since<span style="color: #990000;"><em><strong> <span style="color: #000000;">snowyDays </span></strong></em><span style="color: #000000;">=</span></span> <strong class="hl">c(3, 16, 17, 29, 39, 45, 136, 351, 354, 364, 365)</strong></p>
<p><span style="color: #990000;"><span style="color: #000000;"></span><br></span></p>
<p><em><strong>avgTemp</strong></em>[<strong class="hl">snowyDays</strong>] is equivalent to <em><strong>avgTemp</strong></em>[<strong class="hl">c(3, 16, 17, 29, 39, 45, 136, 351, 354, 364, 365)</strong>];</p>
<p>This gives the temperature on the 11 days indexed in the <em><strong>snowyDays</strong> </em>vector</p>
<p></p>
<p><em><strong>avgWind</strong></em>[<strong class="hl">snowyDays</strong>] is equivalent to <em><strong>avgWind</strong></em>[<strong class="hl">c(3, 16, 17, 29, 39, 45, 136, 351, 354, 364, 365)</strong>];</p>
<p>This gives the winds on the 11 days indexed in the <em><strong>snowyDays</strong></em> vector</p>
<p></p>
<p>The average temperatures and average wind speeds for the 11 days with snow were:</p>
<blockquote>
<p title="Console" class="nn">&gt; snowyDayTemps:</p>
<p title="Console" class="nn">&nbsp;[1] 29 30 18 24 34 9 40 12 11 34 28<br>&gt; snowyDayWinds<br>&nbsp;[1] 10.0 13.8 15.5 10.7 &nbsp;6.8 &nbsp;8.1 10.9 &nbsp;9.4 11.5 16.7 14.0</p>
</blockquote>
<p class="fig">the temperature and wind speeds on the 11 snowy days</p>
<ul></ul>
<h3>Multiple conditions on string values</h3>
<p>Just like with<em><strong> if-else </strong></em>conditional statements, we can create more complex conditions by using the <em><strong>and </strong></em>( <em><strong>&amp;</strong></em> ),&nbsp; <em><strong>or </strong></em>( <strong>| </strong>),&nbsp; <em><strong>not </strong></em>( <em><strong>! </strong></em>), and <em><strong>not equal</strong></em> (<em><strong>!=</strong></em>) operators.</p>
<p></p>
<p>Let's find all days that has rain or snow using the <em><strong>or </strong></em>operator ( <strong>|</strong> ):</p>
<blockquote>
<p>&nbsp; rainOrSnow = which(weatherData$weatherType == "SN" |<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;weatherData$weatherType == "RA");</p>
</blockquote>
<p></p>
<p>There were <strong>39 </strong>days that had rain or snow.&nbsp; Since we know 11 of those days had snow, the other 28 must be rain:</p>
<blockquote>
<p title="Console" class="nn">&gt; rainOrSnow<br>&nbsp;[1] &nbsp; 3 &nbsp;16 &nbsp;17 &nbsp;29 &nbsp;39 &nbsp;45 &nbsp;69 &nbsp;77 &nbsp;82 &nbsp;87 &nbsp;90 110 120 134 136 137 150 158 165 175 <br>[21] 178 193 197 211 224 258 264 271 272 281 282 294 304 313 337 351 354 364 365</p>
</blockquote>
<p class="note">Note: these results also do not include the days that had rain along with other conditions.</p>
<h3>Inverting logic: the <strong>not </strong>operator</h3>
<p>We can reverse the condition to look for days that did not have "RA" nor "SN" using the <em><strong>not </strong></em>( <strong>!</strong> ) operator.&nbsp;</p>
<p></p>
<p>The original condition was:</p>
<blockquote>
<p class="nn">weatherData$weatherType == "SN" |&nbsp; weatherData$weatherType == "RA"</p>
</blockquote>
<p></p>
<p>You can invert a condition using the <em><strong>not </strong></em>operator ( <strong>!</strong> ) and parentheses around the original condition:</p>
<blockquote>
<p class="nn">!(weatherData$weatherType == "SN" |&nbsp; weatherData$weatherType == "RA")</p>
</blockquote>
<p></p>
<p>And then put the inverted condition into the <em><strong>which()</strong></em> statement.&nbsp; Here we are saying, "<em><strong>which </strong></em>days did <em><strong>not </strong></em>have (snow <em><strong>or </strong></em>rain)"</p>
<blockquote>
<p>&nbsp; noRainNorSnow = which(<em class="hl">!(</em>weatherData$weatherType == "SN" |<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; weatherData$weatherType == "RA"<em class="hl">)</em>);</p>
</blockquote>
<p></p>
<p>And we see that <em><strong>noRainNorSnow </strong></em>has <strong>327 </strong>values, which is <strong>366-39</strong>:</p>
<blockquote>
<p title="Environment" class="nn">noRainNorSnow: int [1:327] 1 2 4 5 6 7 ...</p>
<p>rainOrSnow:&nbsp;&nbsp;&nbsp; int [1:39] 3 16 17 29 39 ...</p>
</blockquote>
<p></p>
<p>An equivalent way to reverse the logic is to say, "<em><strong>which </strong></em>days that did <em><strong>not </strong></em>have snow <em><strong>and </strong></em>days that did <em><strong>not </strong></em>have rain"</p>
<blockquote>
<p>&nbsp;noRainNorSnow2 = which(weatherData$weatherType != "SN" <em class="hl">&amp;</em><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; weatherData$weatherType != "RA"<em class="hl"></em>);</p>
</blockquote>
<p></p>
<p>The result is the same:</p>
<blockquote>
<p title="Environment" class="nn">noRainNorSnow2: int [1:327] 1 2 4 5 6 7 ...</p>
</blockquote>
<h3>Two common ways to Incorrectly invert logic</h3>
<p>In this section, we will look at two common ways to incorrectly invert logic.&nbsp;</p>
<h4>Forgetting the parenthesis:</h4>
<p>If you take this condition:</p>
<blockquote>
<p>weatherData$weatherType == "SN" |&nbsp; weatherData$weatherType == "RA"</p>
</blockquote>
<p></p>
<p>And put a <em><strong>not </strong></em>operator in front without parentheses:</p>
<blockquote>
<p>!weatherData$weatherType == "SN" |&nbsp; weatherData$weatherType == "RA"</p>
</blockquote>
<p></p>
<p>Then you have the logic: <em><strong>not </strong></em>SN <em><strong>or </strong></em>rain.</p>
<p></p>
<p>So, you will get all days that:</p>
<ul>
<li>did not have snow <em><strong>or</strong></em></li>
<li>did have rain</li>
</ul>
<h4>Forgetting to flip the <em><strong>or/and </strong><strong></strong></em>operator</h4>
<p>If you choose to use the <em><strong>not equal </strong></em>operators on each component of the condition, then you need to flip the operator from <em><strong>or </strong></em>to <em><strong>and </strong></em>(or vice versa).&nbsp;</p>
<p></p>
<p>Here we did not flip the operator and kept the conditional operator <em><strong>or</strong></em>:</p>
<blockquote>
<p>noRainNorSnow_bad = which(weatherData$weatherType != "SN" <span>|</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; weatherData$weatherType != "RA");</p>
</blockquote>
<p></p>
<p>And the result is that all 366 values meet the condition:</p>
<blockquote>
<p title="Environment" class="nn">noRainNorSnow_bad: int [1:366] 1 2 3 4 5 6 7 ...</p>
</blockquote>
<p id="allvalues" class="fig">all values meet the conditnion of <strong>not </strong>rain and <strong>not </strong>snow</p>
<p></p>
<p>In the application for this lesson, I will let you explain why saying "<em><strong>not </strong></em>snow <em><strong>or </strong><strong>not </strong></em>rain" gives you every value in the column.</p>
<h3>Conditions from different columns</h3>
<p>We also can combine conditions from two different columns.&nbsp; For examples, let's get all days that were raining and 70 degrees or more:</p>
<blockquote>
<p>&nbsp; rainAndHighTemps = which(weatherData$weatherType == "RA" &amp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;weatherData$avgTemp &gt;= 70);</p>
</blockquote>
<p></p>
<p>There are 7 days where both these condition (rain and temperatures 70 or more) occurred:</p>
<blockquote>
<p title="Console" class="nn">&gt; rainAndHighTemps</p>
<p>&nbsp;[1] 150 178 193 197 211 224 264</p>
</blockquote>
<p id="rainhightemp" class="fig">Days with rain and average temperatures at or above 70</p>
<h2>Multiple conditions on multiple variables</h2>
<p>Similar to <em><strong>if()</strong></em>, we can use <em><strong>which()</strong></em> to create more complex condition<em class="hl"></em>.&nbsp; The trick is to make sure you have the parentheses correct, because, like in Algebra, parentheses determine the order of operations.&nbsp; <em class="note">Note: in programming, just like Algebra, adding extra parentheses does not hurt.</em></p>
<p></p>
<p>So, let's say we want days where there was rain <em><strong>or </strong></em>snow and temperatures between 25<strong><em> </em></strong><em><strong>and </strong></em>40:</p>
<blockquote>
<p>&nbsp; complexCond = which( (weatherData$weatherType == "RA" |&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; weatherData$weatherType == "SN") &amp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(weatherData$avgTemp &gt;= 25 &amp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; weatherData$avgTemp &lt;= 40) );</p>
</blockquote>
<p></p>
<p>There were 7 days that meet all the conditions above:</p>
<blockquote>
<p title="Environment" class="nn">compleCond: int [1:7] 3 16 39 136 337 364 365</p>
</blockquote>
<p class="fig" id="complex">The results of a more complex condition inside a <strong>which() </strong>statement</p>
<h3>Combining conditional statements</h3>
<p>For the above code, we have the inner parentheses with these two conditional statements:</p>
<blockquote>(weatherData$weatherType == "RA" | weatherData$weatherType == "SN")</blockquote>
<blockquote>(weatherData$avgTemp &gt;= 25 &amp; weatherData$avgTemp &lt;= 40)</blockquote>
<p></p>
<p>And an outer parenthses that <em><strong>ands </strong></em>the two conditional statements together:</p>
<blockquote>
<p><em class="hl">( </em>(weatherData$weatherType == "RA" | weatherData$weatherType == "SN") <em class="hl">&amp;</em><br>&nbsp; (weatherData$avgTemp &gt;= 25 &amp; weatherData$avgTemp &lt;= 40) <em class="hl">)</em></p>
</blockquote>
<p></p>
<p>In the Console we can break down the steps:</p>
<blockquote>
<p title="Console" class="nn">&gt; which(weatherData$weatherType == "RA" | weatherData$weatherType == "SN")<br>&nbsp;[1] &nbsp; <em class="hl">3 &nbsp;16</em> &nbsp;17 &nbsp;29 &nbsp;<em class="hl">39 &nbsp;</em>45 &nbsp;69 &nbsp;77 &nbsp;82 &nbsp;87 &nbsp;90 110 120 134 <em class="hl">136 </em>137 150<br>[18] 158 165 175 178 193 197 211 224 258 264 271 272 281 282 294 304 313<br>[35] <em class="hl">337 </em>351 354 <em class="hl">364 365</em><br>&gt; which(weatherData$avgTemp &gt;= 25 &amp; weatherData$avgTemp &lt;= 40)<br>&nbsp;[1] &nbsp; 1 &nbsp; 2 &nbsp; <em class="hl">3</em> &nbsp; 6 &nbsp; 7 &nbsp; 8 &nbsp; 9 &nbsp;10 &nbsp;14 &nbsp;15 &nbsp;<em class="hl">16 &nbsp;</em>25 &nbsp;26 &nbsp;27 &nbsp;28 &nbsp;30 &nbsp;32<br>[18] &nbsp;33 &nbsp;34 &nbsp;35 &nbsp;36 &nbsp;37 &nbsp;38 &nbsp;<em class="hl">39 &nbsp;</em>40 &nbsp;47 &nbsp;52 &nbsp;53 &nbsp;54 &nbsp;55 &nbsp;56 &nbsp;57 &nbsp;58 &nbsp;60<br>[35] &nbsp;65 &nbsp;66 &nbsp;78 &nbsp;79 &nbsp;80 &nbsp;81 &nbsp;83 &nbsp;84 &nbsp;85 &nbsp;86 &nbsp;88 &nbsp;89 &nbsp;93 &nbsp;94 &nbsp;95 &nbsp;96 &nbsp;97<br>[52] &nbsp;98 &nbsp;99 100 101 103 <em class="hl">136 </em>300 301 317 324 325 326 327 328 330 331 332<br>[69] 336 <em class="hl">337 </em>338 339 340 341 342 343 344 346 347 356 357 358 359 360 362<br>[86] 363 <em class="hl">364 365</em> 366</p>
</blockquote>
<p></p>
<p>And see that <em><strong>3, 16, 39, 136, 337, 364, </strong></em>and <strong></strong><em><strong>365</strong></em> are the only value in both conditional statements.</p>
<h2>Finding patterns within strings</h2>
<p>The elephant in the room is that we are only capturing days that <em class="hl">exclusively </em>had snow or rain using <em><strong>which()</strong></em>.</p>
<p></p>
<p>But we know from looking at the <em><strong>weatherType </strong></em>column (<em id="r-weatherTypeCol" class="ref">fig ##</em>) that many values in <em><strong>weatherType </strong></em>have "SN" or "RA" with other weather conditions -- and these are not being captured because <em><strong>which()</strong></em> only checks for values that are exactly "SN".&nbsp;</p>
<p></p>
<p>We really want <em class="hl">every value that contains "SN"</em>.&nbsp; This cannot be easily done using <em><strong>which()</strong></em> but it can be done easily using <em><strong>grep()</strong><strong>.&nbsp; grep() </strong></em>is a powerful tool that allows one to search for <em><strong>patterns </strong></em>within a string.&nbsp;</p>
<h3>A quick grep() example</h3>
<p><em><strong>grep()</strong></em> is a very powerful tool for finding patterns within strings (the process is known as Regular Expressions, which would take many lessons to properly teach).&nbsp; In this lesson, we are only using the most basic functionality in <em><strong>grep()</strong></em> which is finding a substring within a string.</p>
<p></p>
<p>Let's start with this vector:</p>
<p class="code p">grepTestVec = c("one fish", "two fish", "one llama", "two llama",</p>
<p class="code">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "red fish", "blue fish");</p>
<p><em><strong></strong></em></p>
<p><em><strong>grep()</strong></em> return the indices of the vectors value that contain the substring specified:</p>
<p class="code p">test1 = grep("two", grepTestVec);&nbsp; # values that have the substring "two"</p>
<p class="code">test2 = grep("lla", grepTestVec); &nbsp;# values that have the substring "lla"</p>
<p class="code">test3 = grep("fish", grepTestVec); # values that have the substring "fish"</p>
<p></p>
<p>And we can match the index values below with the values in <em><strong>grepTestVec</strong></em>:</p>
<blockquote>
<p title="Environment" class="nn">test1: int [1:2] 2 4</p>
<p>test2: int [1:2] 3 4</p>
<p>test3: int [1:2]1 2 5 6</p>
</blockquote>
<h3>Using grep() to find patterns within a dataframe</h3>
<p>We are going to use <em><strong>grep()</strong></em> to find the substring ("SN") contained within a vector of string values (<em><strong>weatherType</strong></em>):</p>
<p class="code partial">snowyDaysGrep = grep(weatherData$weatherType, pattern="SN");</p>
<p></p>
<p><em><strong>grep(),</strong></em><strong>&nbsp;</strong>like <em><strong>which(</strong><strong>)</strong></em>, <em></em>produces a vector of the index values that meets the condition (i.e., index of the <em><strong>weatherType </strong></em>values that contain "SN").</p>
<p></p>
<p>And we can see there were actually 65 days that had snow -- a much more reasonable result for Lansing, MI!</p>
<blockquote>
<p title="Environment" class="nn">snowyDaysGrep: int [1:65] 1 3 4 10 11 12 13 14 16 17...</p>
</blockquote>
<h3>Subsetting vectors</h3>
<p><em><strong>snowyDaysGrep</strong></em> is a vector with 65 indexed values, representing the 65 days in Lansing that had snow.</p>
<p>&nbsp;</p>
<p>Just like before, we can use the results of a <em><strong>grep() </strong></em>to index another column.&nbsp; We will use <em><strong>snowyDaysGrep </strong></em>to index the <em><strong>avgTemp</strong> </em>and <em><strong>windSpeed </strong></em>columns in <em><strong>weatherData</strong></em>:</p>
<p class="code partial">snowDaysGrepTemp = weatherData$avgTemp[snowyDaysGrep];<br>snowDaysGrepWind = weatherData$windSpeed[snowyDaysGrep];</p>
<p></p>
<p>And we can see the average temperature and wind speeds for the 65 days that had snow:</p>
<blockquote>
<p title="Console" class="nn">&gt; snowDaysGrepTemp<br>&nbsp;[1] 26 29 17 27 13 18 15 26 30 18 11 13 17 19 22 36 26 30 24 38 26 26 34 28<br>[25] 16 14 &nbsp;9 20 27 20 30 29 34 22 19 18 20 28 34 32 36 28 35 33 28 34 40 40<br>[49] 34 33 28 26 23 26 28 18 15 10 12 21 14 11 36 34 28<br>&gt; snowDaysGrepWind<br>&nbsp;[1] 15.5 10.0 &nbsp;7.7 17.8 12.2 18.2 13.2 &nbsp;5.6 13.8 15.5 13.1 &nbsp;7.6 &nbsp;4.4 &nbsp;5.5<br>[15] &nbsp;6.3 18.2 13.3 14.1 10.7 13.5 &nbsp;7.9 &nbsp;7.3 &nbsp;6.8 12.9 13.8 14.5 &nbsp;8.1 &nbsp;6.9<br>[29] &nbsp;3.8 &nbsp;5.9 18.9 16.5 16.2 13.1 &nbsp;9.7 &nbsp;3.7 &nbsp;2.2 &nbsp;5.4 10.2 10.4 10.9 11.6<br>[43] 10.7 &nbsp;7.9 &nbsp;9.4 13.8 10.9 19.2 &nbsp;5.9 &nbsp;8.6 16.7 10.2 &nbsp;8.6 10.3 13.8 10.8<br>[57] 16.7 11.3 &nbsp;9.4 &nbsp;4.1 &nbsp;8.1 11.5 &nbsp;7.3 16.7 14.0</p>
</blockquote>
<p class="note"></p>
<p class="note">note: if you want to sort the values, you can use <strong>sort(snowDaysGrepWind)</strong></p>
<h2>grep() with the | condition:</h2>
<p>Similar to <em><strong>which() </strong></em>statements, we can use the <em><strong>or</strong></em> (<em><strong> |</strong></em> ) operator to find all values in <em><strong>weatherType </strong></em><em class="hl">that contain either</em> <strong>SN</strong> or <strong>RN</strong>:</p>
<p class="code">daysWithPrecipGrep = grep(weatherData$weatherType, pattern="RA|SN");</p>
<p></p>
<p>And we get a vector with 179 values in it, representing the 179 days that had rain or snow (or both):</p>
<p class="code nn" title="Environment">daysWithPrecipGrep: int[1:179] 1 3 4 8 9 10 ...</p>
<p></p>
<p>An equivalent result can be obtained by getting the <em><strong>grep() </strong></em>results for <em><strong>RA </strong></em>and <em><strong>SN </strong></em>separately and then combining them using <em><strong>union()</strong></em>:</p>
<blockquote>
<p>rainyDaysGrep = grep("RA", weatherData$weatherType);</p>
<p>snowyDaysGrep = grep("SN", weatherData$weatherType);</p>
<p class="code nn" title="Environment">daysWithPrecipUnion = union(rainyDaysGrep, snowyDaysGrep);</p>
</blockquote>
<p></p>
<p>Looking at the days with rain, snow, and the combination of the two:</p>
<blockquote>
<p title="Environment" class="nn">rainyDaysGrep: &nbsp; &nbsp; &nbsp; int[1:124] 8 9 10 15 25 26 ...</p>
<p>snowyDaysGrep:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int[1:65] 1 3 4 10 11 12 13 ...</p>
<p class="code nn" title="Environment">daysWithPrecipUnion: int[1:179] 1 3 4 8 9 10 ...</p>
</blockquote>
<p class="note">Note: the rainy days and snowy days adds up to 189 whereas the union has only 179 days.&nbsp; This is because there were 10 days that had both rain and snow... like day 10.</p>
<h3>More complex union() scenario</h3>
<p>Using <em><strong>union() </strong></em>seems more complicated than just using the <strong><em>or</em></strong> operator&nbsp; ( <strong>|</strong> ) in <em><strong>grep()</strong></em>, but <em><strong>union()</strong></em> allows for more complex situations.&nbsp;</p>
<p></p>
<p>For instance if we want to combine results from different columns like days that were hazy (<em><strong>HZ</strong></em>) or had temperatures above <strong>90 </strong>(<em><strong>maxTemp </strong></em>&gt; 90):</p>
<blockquote>
<p>hazyDays = grep(weatherData$weatherType, pattern="RA");</p>
<p>hotDays = which(weatherData$maxTemp &gt; 90);</p>
<p>hazyOrHotDays = union(hazyDays, hotDays);</p>
</blockquote>
<p></p>
<p>And we see there were 124 hazy days, 11 hot days, and 132 days that were hazy or hot:</p>
<blockquote>
<p title="Environment" class="nn">hazyDays int[1:124] 8 9 10 15 25...</p>
<p>hotDays: int[1:11] 163 171 194 202 ...</p>
<p>hazyOrHotDays: int[1:132] 8 9 10 15 25...</p>
</blockquote>
<p id="hazyhot" class="fig">Using <strong>union()</strong> to combine hazy and hot days</p>
<h3>An alternative to &amp; when using grep()</h3>
<p>With<em><strong> grep()</strong></em> we can find days with rain <em><strong>or </strong></em>snow using the <em><strong>or </strong></em>operator ( <strong>| </strong>)&nbsp; but we cannot use<em><strong> grep()</strong></em> to return days with <em><strong>both</strong> </em>rain <em><strong>and</strong> </em>snow (i.e., there is no <em><strong>&amp;</strong> </em>operator in<em><strong> grep()</strong></em>)</p>
<p class="code partial">#### this does not work!</p>
<p class="code partial"># daysWithRainAndSnow = grep(weatherData$weatherType, pattern="RN&amp;SN");</p>
<p></p>
<p>The reason for this requires a lengthy explanation of how <em><strong>grep()</strong> works </em>(and regular expressions, in general), which is beyond the scope of this class.</p>
<p></p>
<p>What we want is the <em class="hl">index values that are in both </em><em class="hl"><strong>rainyDaysGrep </strong>and</em><span class="hl"> <strong>snowyDaysGrep</strong></span><strong> </strong>.</p>
<p></p>
<p>Luckily, there is a function for that called <em><strong>intersect()</strong></em>.&nbsp; <em><strong>inters</strong><strong>ect</strong><strong>() </strong></em>is the sibling function to <em><strong>union()</strong></em>, <em><strong>intersect() </strong></em>takes two vectors and produces a vector of values that occur in both the original vectors.</p>
<p></p>
<p>In this case we will use <em><strong>intersect()</strong></em> on the vectors <em><strong>rainyDaysGrep </strong></em>and <em><strong>snowDaysGrep</strong></em>:</p>
<p class="code partial">daysWithRainAndSnow = intersect(rainyDaysGrep, snowyDaysGrep);</p>
<p></p>
<p><strong><em>daysWithRainAndSnow </em></strong>has <strong>10</strong> values, representing the <strong>10</strong> values that are in both <em><strong>rainyDaysGrep </strong></em>and <em><strong>snowyDaysGrep</strong></em></p>
<blockquote>
<p title="Console" class="nn">&gt; daysWithRainAndSnow<br>&nbsp;[1] &nbsp;10 &nbsp;26 &nbsp;34 &nbsp;35 &nbsp;84 &nbsp;94 &nbsp;98 101 352 359</p>
</blockquote>
<h2>SetDiff()</h2>
<p><em><strong>union()</strong></em> is functionally similar to the <em><strong>or </strong></em>operator, <em><strong>intersect() </strong></em>is functionally similar to the <em><strong>and </strong></em>operator.</p>
<p></p>
<p>The equivalent to a <em><strong>not </strong></em>operator is a bit more complex -- the function to use is <em><strong>setDiff()</strong></em>.</p>
<p></p>
<p>In <em><strong>setDiff</strong><strong>()</strong></em>, we compare two vectors:</p>
<ul>
<li>a vector with all possible values (so, if there are 366 values, then a vector from 1:366)</li>
<li>the vector we want to invert</li>
</ul>
<p></p>
<p><em><strong>setDiff()</strong></em> returns the <em class="hl">the values in the first vector that are not in the second vector</em> effectively subtracting out values from the second vector that are in the first vector.</p>
<h3>quick example</h3>
<p>If the are 10 values in a vector and 4 of them (<em><strong>3,5,6,9</strong></em>) meet a condition:</p>
<blockquote>
<p>&nbsp; meetsCondition = c(3,5,6,9);<br>&nbsp; invertCondition = setdiff(1:10, meetsCondition);</p>
</blockquote>
<p></p>
<p>And we see that <em><strong>invertCondition </strong></em>is all values from 1 to 10 not represented in <em><strong>meetsCondition</strong></em>:</p>
<blockquote>
<p title="Environment" class="nn">invertCondition: int[1:6] 1 2 4 7 8 10</p>
</blockquote>
<h3>Example using a column</h3>
<p>If we want to find the days without rain or snow, we can take the days with rain or snow:</p>
<p></p>
<p>and use <em><strong>setDiff() </strong></em>to find the difference between that and a vector with all 366 values:</p>
<blockquote>
<p>daysWithoutPrecip = setdiff(1:366, daysWithPrecipGrep);</p>
</blockquote>
<p></p>
<p>And we see that adding up the <em><strong>daysWithPrecipGrep </strong></em>(179) and <em><strong>daysWithoutPrecip </strong></em>(187), we get 366 days:</p>
<blockquote>
<p title="Environment" class="nn">daysWithPrecipGrep: int [1:179] 1 3 4 8 9 10 ...</p>
<p>daysWithoutPrecip:&nbsp; int [1:187] 2 5 6 7 22 24 ...</p>
</blockquote>
<h2>Application</h2>
<p class=""><em class="hl">If you have any questions regarding this application, feel free to</em> <em class="email">email them to the instructor here</em>.&nbsp; <em class="hl">You can attach the whole Project Folder as a<a href="01-01%20RStudio%20and%20Projects.html?ou=457124#zip" target="_blank" rel="noopener"> zipped file</a>.</em></p>
<p class=""></p>
<p>A) Create a new script file named <em><strong>app2-05.r</strong></em> and put it in your <em><strong>scripts </strong></em>folder.</p>
<p></p>
<p>B) In comments at the top of your script answer the following:</p>
<ol>
<li>Why do all values in the <em><strong>weatherType </strong></em>column meet the condition of&nbsp; <em><strong>not </strong></em>rain <em><strong>or </strong></em>snow (<em id="r-allvalues" class="ref">fig ##</em>)?</li>
<li>How many days are both hazy and hot (<em id="r-hazyhot" class="ref">fig ##</em>)?</li>
</ol>
<p></p>
<p>C) Give two ways to change this logic (<em id="r-rainhightemp" class="ref">fig ##</em>) to rain <em><strong>and </strong></em>temperatures <em><strong>less than </strong></em>70:</p>
<ol>
<li>&nbsp;&nbsp; one by changing the conditional operator on the temperature</li>
<li>&nbsp;&nbsp; one by adding a <em><strong>not </strong></em>operator</li>
</ol>
<p class="note">Note: the answer for both will have the same 21 values</p>
<p></p>
<p>D) Modify the <em><strong>which() </strong></em>in<em id="r-complex" class="ref"> fig ##</em> to:</p>
<ol>
<li>find days that were RA, SN, <em class="hl">or HZ</em> with temperatures between 50 and 70</li>
<li>find days that were RA or SN,&nbsp; with temperatures between 50 and 70, <em class="hl">and windspeed between 10 and 30</em></li>
</ol>
<p></p>
<p>E) Use <em><strong>grep()</strong></em> (and <em><strong>union</strong></em>/<em><strong>intersect</strong></em>/<em><strong>setdiff</strong></em>) to find days with snow (SN) but not blowing snow (BLSN)</p>
<p></p>
<p>F) Challenge: Use <em><strong>grep()</strong></em> to on the <em><strong>precip </strong></em>column in <em><strong>weatherType </strong></em>to (<em class="note">note: <strong>precip </strong>is a string column</em>):</p>
<ol>
<li>find all preciptation values greater than or equal to 1.0 (hint: what is a unique substring for values &gt;= 1)</li>
<li>find all preciptation values greater than or equal to 0.8</li>
<li>find all days that have precipitation values greater than 0.8 and have maximum temperatures between 70-80
<ul>
<li>use <em><strong>which() </strong></em>to find the temperatures</li>
</ul>
</li>
</ol>
<h3>Questions to answer</h3>
<p>Answer the following in comments inside your application script:</p>
<ol style="list-style-type: number;">
<li>What was your level of comfort with the lesson/application?</li>
<li>What areas of the lesson/application confused or still confuses you?</li>
<li>What are some things you would like to know more about that is related to, but not covered in, this lesson?</li>
</ol>
</body></html>